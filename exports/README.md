# Exports Directory Documentation

**Directory**: `exports/`
**Purpose**: Storage for generated reports (PDF and CSV) created by users
**Version**: 1.2.0
**Created**: 2025-10-31
**Updated**: 2025-11-01

---

## Overview

The `exports/` directory serves as the dedicated storage location for all user-generated reports exported from the Roach Tracker application. This includes professional PDF documentation reports and CSV data exports suitable for analysis in spreadsheet applications. Files in this directory are automatically generated when users request exports from the Statistics page.

---

## Directory Structure

```
exports/
├── .gitkeep                              # Keeps empty directory in git
├── roach_sightings_YYYYMMDD_HHMMSS.pdf  # PDF reports
├── roach_sightings_YYYYMMDD_HHMMSS.csv  # CSV exports
└── README.md                             # This file
```

---

## Export File Types

### PDF Reports (`roach_sightings_YYYYMMDD_HHMMSS.pdf`)

**Purpose**: Professional documentation reports for property management or legal purposes
**Format**: PDF (Portable Document Format)
**Generated By**: `app/utils.py` - `generate_pdf_report()` function
**Typical Size**: 50KB - 5MB (depending on number of sightings and photos)

#### File Naming Convention

```
roach_sightings_20251031_143022.pdf
│                │        │
│                │        └─ Time (HH:MM:SS in 24-hour format)
│                └─────────── Date (YYYYMMDD)
└──────────────────────────── Fixed prefix
```

**Examples**:
- `roach_sightings_20251031_143022.pdf` - Generated on Oct 31, 2025 at 2:30:22 PM
- `roach_sightings_20251115_091500.pdf` - Generated on Nov 15, 2025 at 9:15:00 AM

#### PDF Report Contents

A generated PDF report includes the following sections:

1. **Header Section**
   - Title: "Roach Sighting Documentation Report"
   - Report generation date and time
   - Application logo/branding
   - User information (if multi-user enabled)

2. **Summary Statistics**
   - Total number of sightings included in report
   - Date range covered (earliest to latest sighting)
   - Unique locations affected
   - Size distribution breakdown
   - Most common sighting patterns

3. **Detailed Sightings Table**
   - Columns: Date & Time, Location, Count, Size, Time of Day, Weather, Notes
   - Sorted chronologically (oldest to newest by default)
   - Each row represents one sighting entry
   - Clear, professional formatting for easy reading

4. **Photo Evidence** (if photos available)
   - Embedded photo thumbnails (scaled to fit page)
   - Photo captions with location and date
   - Up to 4 photos per page (optimized layout)
   - Full resolution photos referenced by filename

5. **Analysis Section**
   - Location frequency analysis (which rooms/areas most affected)
   - Time pattern analysis (morning/afternoon/evening/night distribution)
   - Size trend analysis (small/medium/large over time)
   - Weather correlation observations

6. **Footer Section**
   - Legal disclaimer about warranty of habitability
   - Statement of documentation authenticity
   - Contact information for follow-up
   - Page numbers (e.g., "Page 1 of 5")

#### PDF Generation Technical Details

**Library Used**: ReportLab (Python PDF generation library)
**Font**: Helvetica (standard PDF font, universal compatibility)
**Page Size**: Letter (8.5" × 11") / A4 option available
**Margins**: 1 inch on all sides
**Color Mode**: RGB color space
**Compression**: PDF compression enabled (reduces file size)

**Code Reference**: See `app/utils.py:generate_pdf_report()` (app/utils.py:205)

---

### CSV Exports (`roach_sightings_YYYYMMDD_HHMMSS.csv`)

**Purpose**: Raw data export for analysis in Excel, Google Sheets, or data analysis tools
**Format**: CSV (Comma-Separated Values)
**Generated By**: `app/utils.py` - `generate_csv_export()` function
**Typical Size**: 1KB - 500KB (depending on number of sightings)

#### File Naming Convention

```
roach_sightings_20251031_143022.csv
│                │        │
│                │        └─ Time (HH:MM:SS in 24-hour format)
│                └─────────── Date (YYYYMMDD)
└──────────────────────────── Fixed prefix
```

**Same naming pattern as PDF for consistency**

#### CSV File Structure

**Header Row** (column names):
```csv
ID,Date,Location,Count,Size,Time of Day,Weather,Notes,Photo,User,Property
```

**Data Rows** (example):
```csv
1,2025-10-31 14:30:22,Kitchen,3,medium,afternoon,humid,"Near sink area",uploads/20251031_143022_a7f3b9c2.jpg,admin,Main Property
2,2025-10-31 18:45:10,Bathroom,1,small,evening,dry,"Behind toilet",uploads/20251031_184510_d7e3c9a1.jpg,admin,Main Property
3,2025-11-01 08:15:33,Living Room,5,large,morning,humid,"Under couch",,admin,Main Property
```

#### CSV Columns Explained

| Column | Description | Data Type | Example |
|--------|-------------|-----------|---------|
| **ID** | Unique sighting identifier | Integer | `1`, `42`, `157` |
| **Date** | Date and time of sighting | ISO 8601 DateTime | `2025-10-31 14:30:22` |
| **Location** | Room or area where sighting occurred | Text | `Kitchen`, `Bedroom 2` |
| **Count** | Number of roaches seen | Integer | `1`, `3`, `10` |
| **Size** | Size classification | Text | `small`, `medium`, `large` |
| **Time of Day** | General time period | Text | `morning`, `afternoon`, `evening`, `night` |
| **Weather** | Weather conditions at time of sighting | Text | `dry`, `humid`, `rainy`, `hot`, `cold` |
| **Notes** | Additional observations | Text | `Near food source`, `Multiple nymphs` |
| **Photo** | Photo filename (if available) | Text/Filename | `uploads/20251031_143022_a7f3b9c2.jpg` or empty |
| **User** | Username of person who logged sighting | Text | `admin`, `johndoe` |
| **Property** | Property name (multi-tenant mode) | Text | `Main Property`, `Building A - Unit 201` |

#### CSV Format Details

**Encoding**: UTF-8 with BOM (Byte Order Mark)
- BOM ensures proper encoding detection in Excel
- UTF-8 supports international characters (Ñ, É, ü, etc.)

**Line Endings**: CRLF (`\r\n`) - Windows/Excel standard
**Delimiter**: Comma (`,`)
**Text Qualifier**: Double quotes (`"`) for fields containing commas or newlines
**Escaping**: Double quotes escaped as `""` inside quoted fields

**RFC 4180 Compliant**: Follows the official CSV specification for maximum compatibility

**Code Reference**: See `app/utils.py:generate_csv_export()` (app/utils.py:280)

---

## Access and Usage

### Generating Exports via Web Interface

**Step 1**: Navigate to Statistics page
```
Dashboard → Statistics (in navigation menu)
```

**Step 2**: Scroll to Export section at bottom of page

**Step 3**: Click desired export button
- "Export PDF Report" - Generates PDF documentation
- "Export CSV Data" - Generates CSV spreadsheet

**Step 4**: File downloads automatically
- Browser downloads file to configured download folder
- Filename includes timestamp for uniqueness
- File also saved to `exports/` directory on server

**Step 5**: Open exported file
- PDF: Open with PDF reader (Adobe Acrobat, Preview, Chrome, Firefox)
- CSV: Open with Excel, Google Sheets, LibreOffice Calc, or text editor

### Programmatic Access

Files in the `exports/` directory are accessible via Flask's static file serving:

**URL Pattern**:
```
http://localhost:5000/exports/roach_sightings_20251031_143022.pdf
http://localhost:5000/exports/roach_sightings_20251031_143022.csv
```

**Direct File System Access**:
```python
import os

exports_dir = 'exports/'
pdf_files = [f for f in os.listdir(exports_dir) if f.endswith('.pdf')]
csv_files = [f for f in os.listdir(exports_dir) if f.endswith('.csv')]

# Most recent export
latest_pdf = sorted(pdf_files, reverse=True)[0] if pdf_files else None
```

**Security Note**: The exports directory should NOT be publicly accessible in production environments. Consider implementing authentication checks for export downloads.

---

## File Management

### Automatic Cleanup (Recommended)

Export files can accumulate over time and consume disk space. Consider implementing automated cleanup:

**Option 1**: Cleanup old exports (30+ days)
```python
# Add to app/utils.py
def cleanup_old_exports(max_age_days=30):
    """Delete export files older than specified days"""
    import os
    import time

    exports_dir = 'exports/'
    cutoff_time = time.time() - (max_age_days * 86400)

    for filename in os.listdir(exports_dir):
        if filename.endswith(('.pdf', '.csv')):
            filepath = os.path.join(exports_dir, filename)
            if os.path.getmtime(filepath) < cutoff_time:
                os.remove(filepath)
                print(f"Deleted old export: {filename}")
```

**Run via cron job** (Linux/macOS):
```bash
# Run cleanup daily at 3am
0 3 * * * cd /path/to/Roach-Tracker && python -c "from app.utils import cleanup_old_exports; cleanup_old_exports(30)"
```

**Option 2**: Limit total number of exports
```python
def limit_exports_count(max_count=50):
    """Keep only the N most recent exports"""
    import os

    exports_dir = 'exports/'
    files = [f for f in os.listdir(exports_dir) if f.endswith(('.pdf', '.csv'))]

    # Sort by modification time, oldest first
    files.sort(key=lambda f: os.path.getmtime(os.path.join(exports_dir, f)))

    # Delete oldest files if over limit
    while len(files) > max_count:
        old_file = files.pop(0)
        os.remove(os.path.join(exports_dir, old_file))
        print(f"Deleted excess export: {old_file}")
```

### Manual Cleanup

**Delete all exports**:
```bash
cd /path/to/Roach-Tracker/exports
rm *.pdf *.csv
```

**Delete exports older than 30 days** (Linux/macOS):
```bash
cd /path/to/Roach-Tracker/exports
find . -name "roach_sightings_*.pdf" -mtime +30 -delete
find . -name "roach_sightings_*.csv" -mtime +30 -delete
```

**Delete exports older than 30 days** (Windows PowerShell):
```powershell
cd C:\path\to\Roach-Tracker\exports
Get-ChildItem -Filter "roach_sightings_*.pdf" | Where-Object {$_.LastWriteTime -lt (Get-Date).AddDays(-30)} | Remove-Item
Get-ChildItem -Filter "roach_sightings_*.csv" | Where-Object {$_.LastWriteTime -lt (Get-Date).AddDays(-30)} | Remove-Item
```

### Archive Old Exports

Instead of deleting, consider archiving old exports:

```bash
# Create archive directory
mkdir -p exports/archive/

# Move files older than 90 days to archive
find exports/ -maxdepth 1 -name "roach_sightings_*.pdf" -mtime +90 -exec mv {} exports/archive/ \;
find exports/ -maxdepth 1 -name "roach_sightings_*.csv" -mtime +90 -exec mv {} exports/archive/ \;

# Compress archived files
cd exports/archive/
tar -czf exports_archive_$(date +%Y%m%d).tar.gz *.pdf *.csv
rm *.pdf *.csv
```

---

## Storage Considerations

### Disk Space Usage

**Typical File Sizes**:
- PDF with 10 sightings, no photos: ~50KB
- PDF with 50 sightings, 20 photos: ~2MB
- PDF with 200 sightings, 100 photos: ~10MB
- CSV with 100 sightings: ~15KB
- CSV with 1000 sightings: ~120KB

**Estimated Storage Requirements**:
- 100 exports/month (50 PDF + 50 CSV): ~150MB/month
- 1000 exports/year: ~1.5GB/year
- Most home installations: < 500MB total (plenty of room)

**Monitor Disk Space**:
```bash
# Check exports directory size
du -sh exports/

# Check available disk space
df -h .
```

### Backup Recommendations

**Include exports in backups**: YES
- Reports are valuable historical documentation
- Regenerating reports requires original sighting data
- PDFs capture point-in-time snapshots

**Backup Strategy**:
1. **Daily incremental backups** of entire project directory (includes exports/)
2. **Weekly full backups** to external storage or cloud
3. **Monthly archive** of old exports to long-term storage

**Example Backup Script**:
```bash
#!/bin/bash
# backup_roach_tracker.sh

BACKUP_DIR="/backup/roach-tracker"
DATE=$(date +%Y%m%d_%H%M%S)

# Create backup directory
mkdir -p "$BACKUP_DIR"

# Backup entire project (including exports and database)
tar -czf "$BACKUP_DIR/roach_tracker_backup_$DATE.tar.gz" \
    --exclude='venv' \
    --exclude='__pycache__' \
    /path/to/Roach-Tracker/

echo "Backup completed: roach_tracker_backup_$DATE.tar.gz"
```

---

## Use Cases for Exports

### PDF Reports

**1. Property Management Communication**
- Send professional documentation to landlord/property manager
- Attach to maintenance requests or complaints
- Provide evidence of ongoing infestation issues
- Track response times and corrective actions

**2. Legal Documentation**
- Use as evidence in habitability disputes
- Support rent escrow or withholding claims
- Document pattern of neglect or failure to remediate
- Provide to tenant advocacy organizations

**3. Health Department Reporting**
- Submit to local health/code enforcement
- Support public health complaints
- Document unsanitary conditions
- Trigger official inspections

**4. Insurance Claims**
- Document property damage caused by infestation
- Support claims for relocation expenses
- Provide evidence for health-related claims
- Establish timeline of infestation

**5. Personal Records**
- Maintain detailed history for personal files
- Track effectiveness of pest control treatments
- Monitor seasonal patterns or trends
- Share with new tenants/buyers (disclosure)

### CSV Exports

**1. Data Analysis**
- Import into Excel/Google Sheets for pivot tables
- Create custom charts and visualizations
- Perform statistical analysis (correlation, regression)
- Identify patterns not visible in web interface

**2. Integration with Other Systems**
- Import into property management software
- Combine with maintenance request data
- Merge with other environmental data (temperature, humidity)
- Feed into business intelligence (BI) tools

**3. Backup and Portability**
- Human-readable backup of sighting data
- Migrate data to different pest tracking systems
- Share raw data with pest control professionals
- Preserve data if application is unavailable

**4. Custom Reporting**
- Create customized reports in Word/Pages
- Design infographics with data visualization tools
- Generate dashboards in Tableau, Power BI, etc.
- Produce multi-property comparison reports

**5. Research and Advocacy**
- Anonymize and aggregate data for tenant advocacy research
- Contribute to public health studies
- Support policy advocacy with data-driven evidence
- Publish findings on housing quality issues

---

## Troubleshooting

### Export Generation Fails

**Issue**: Clicking export button shows error message
**Possible Causes**:
1. No sightings in database to export
2. Insufficient disk space
3. File permissions issue
4. Missing required libraries (ReportLab for PDF)

**Solutions**:
```bash
# Check if sightings exist
sqlite3 data/roach_tracker.db "SELECT COUNT(*) FROM sightings;"

# Check disk space
df -h .

# Check directory permissions
ls -la exports/
# Should be writable by web server user

# Install missing libraries
pip install reportlab
```

### Cannot Open PDF

**Issue**: PDF file won't open or shows errors
**Possible Causes**:
1. Incomplete download (file corruption)
2. Unsupported PDF reader
3. PDF generation error

**Solutions**:
- Re-download the PDF file
- Try opening in different PDF reader (Adobe Acrobat, Chrome, Firefox)
- Check server logs for PDF generation errors
- Verify ReportLab library version: `pip show reportlab`

### CSV Opens with Garbled Text

**Issue**: CSV file shows strange characters instead of text
**Cause**: Encoding issue (UTF-8 not detected)

**Solutions**:

**In Excel**:
1. Open Excel (blank workbook)
2. Go to Data → Get Data → From File → From Text/CSV
3. Select the CSV file
4. Ensure File Origin is set to "65001: Unicode (UTF-8)"
5. Click Load

**In Google Sheets**:
1. File → Import → Upload tab
2. Select the CSV file
3. Import location: Replace current sheet
4. Separator type: Comma
5. Click Import data

**In LibreOffice Calc**:
- Should detect UTF-8 automatically
- If not, select "Unicode (UTF-8)" in import dialog

### Missing Photos in PDF

**Issue**: PDF report shows placeholder boxes instead of photos
**Possible Causes**:
1. Photo files deleted or moved
2. Incorrect file paths in database
3. Photo file permissions

**Solutions**:
```bash
# Verify photo files exist
ls -la static/uploads/

# Check database photo paths
sqlite3 data/roach_tracker.db "SELECT photo_path FROM sightings WHERE photo_path IS NOT NULL;"

# Verify file permissions
chmod 644 static/uploads/*.jpg
```

### Export File Not Found

**Issue**: Export completes but file doesn't exist
**Cause**: File saved but in unexpected location

**Solutions**:
```bash
# Search for recent PDF exports
find . -name "roach_sightings_*.pdf" -mtime -1

# Check if exports directory exists
ls -la exports/

# Verify Flask app configuration
python -c "from app import create_app; app = create_app(); print(app.config['EXPORT_FOLDER'])"
```

---

## Security Considerations

### Export File Access Control

**Current Implementation**: Exports are stored in `exports/` directory, which may be publicly accessible depending on Flask configuration.

**Security Risks**:
- Unauthorized users could access exports via direct URL
- Export filenames are predictable (timestamp-based)
- Exports may contain sensitive personal information

**Recommended Mitigations**:

**1. Implement Authentication for Exports**
```python
# In app/main.py
@app.route('/exports/<filename>')
@login_required
def serve_export(filename):
    """Serve export file with authentication check"""
    # Verify user owns this export or is admin
    return send_from_directory('exports', filename)
```

**2. Use User-Specific Export Directories**
```python
# In app/utils.py
def get_export_path(user_id):
    """Create user-specific export directory"""
    export_dir = f'exports/user_{user_id}/'
    os.makedirs(export_dir, exist_ok=True)
    return export_dir
```

**3. Add Random Token to Filenames**
```python
import secrets

# Generate filename with random token
token = secrets.token_hex(16)
filename = f'roach_sightings_{timestamp}_{token}.pdf'
```

**4. Configure Web Server to Block Direct Access**

**Apache (.htaccess)**:
```apache
<Directory /path/to/Roach-Tracker/exports>
    Require all denied
</Directory>
```

**Nginx (nginx.conf)**:
```nginx
location /exports/ {
    deny all;
    return 404;
}
```

### Data Privacy in Exports

**Personal Information in Exports**:
- User names (who logged each sighting)
- Property addresses
- Timestamps (may reveal living patterns)
- Photos (may contain identifiable information)

**Best Practices**:
- Anonymize exports when sharing with third parties
- Redact personal information for public use
- Encrypt exports when transmitting via email
- Delete exports after they're no longer needed

**Anonymize CSV for Research**:
```python
import pandas as pd

# Load CSV
df = pd.read_csv('exports/roach_sightings_20251031_143022.csv')

# Remove personal information
df = df.drop(columns=['User', 'Property', 'Photo'])

# Anonymize dates (keep only month/year)
df['Date'] = pd.to_datetime(df['Date']).dt.to_period('M')

# Save anonymized version
df.to_csv('exports/anonymized_data.csv', index=False)
```

---

## Future Enhancements

**Planned Features**:

1. **Scheduled Exports** - Automatic weekly/monthly report generation
2. **Email Delivery** - Send exports directly to property manager email
3. **Cloud Backup** - Auto-backup exports to Google Drive, Dropbox
4. **Export Templates** - Customizable PDF templates (letterhead, branding)
5. **Excel Format** - Native .xlsx export (instead of CSV)
6. **Multi-Format Export** - Generate PDF + CSV in one click
7. **Export History** - Track all exports with timestamps and download links
8. **Comparison Reports** - Side-by-side comparison of date ranges
9. **Compressed Archives** - ZIP file containing all sightings + photos
10. **Public Sharing** - Generate shareable link with expiration date

---

## Related Documentation

- [Application Backend README](../app/README.md) - Report generation code (`utils.py`)
- [Main README](../README.md) - Project overview and usage guide

---

## Version History

### v1.2.0 (2025-10-31)
- Added user information to PDF exports
- Enhanced PDF formatting and layout
- Improved CSV UTF-8 encoding with BOM
- Added photo embedding in PDF reports

### v1.1.0 (2025-10-31)
- Added multi-user support to exports
- Include username and property in CSV exports
- Enhanced PDF report header with user context

### v1.0.0 (2025-10-31)
- Initial PDF report generation
- Initial CSV export functionality
- Automatic file naming with timestamps
- Basic export directory structure

---

## Contact & Support

For issues, questions, or contributions:
- GitHub Issues: https://github.com/dnoice/Roach-Tracker/issues
- Main README: [../README.md](../README.md)

---

**Version**: 1.2.0
**Created**: 2025-10-31
**Updated**: 2025-11-01
**Author**: dnoice + Claude AI
