{% extends "base.html" %}

{% block title %}Edit Sighting #{{ sighting.id }} - Roach Tracker{% endblock %}

{% block content %}
<div class="form-page">
    <header class="page-header">
        <h1>Edit Sighting #{{ sighting.id }}</h1>
        <p class="subtitle">Update sighting information</p>
    </header>

    <form action="{{ url_for('edit_sighting', sighting_id=sighting.id) }}" method="POST" enctype="multipart/form-data" class="sighting-form">
        <!-- Date and Time -->
        <div class="form-section">
            <h2>When?</h2>
            <div class="form-group">
                <label for="timestamp">Date & Time</label>
                <input type="datetime-local" id="timestamp" name="timestamp" class="form-control"
                       value="{{ sighting.timestamp[:16] }}">
            </div>
        </div>

        <!-- Location -->
        <div class="form-section">
            <h2>Where?</h2>
            <div class="form-group">
                <label for="location">Location *</label>
                <input type="text" id="location" name="location" class="form-control" required
                       value="{{ sighting.location }}">
            </div>
            <div class="form-group">
                <label for="room_type">Room Type</label>
                <select id="room_type" name="room_type" class="form-control">
                    <option value="">Select...</option>
                    <option value="Kitchen" {% if sighting.room_type == 'Kitchen' %}selected{% endif %}>Kitchen</option>
                    <option value="Bathroom" {% if sighting.room_type == 'Bathroom' %}selected{% endif %}>Bathroom</option>
                    <option value="Bedroom" {% if sighting.room_type == 'Bedroom' %}selected{% endif %}>Bedroom</option>
                    <option value="Living Room" {% if sighting.room_type == 'Living Room' %}selected{% endif %}>Living Room</option>
                    <option value="Hallway" {% if sighting.room_type == 'Hallway' %}selected{% endif %}>Hallway</option>
                    <option value="Basement" {% if sighting.room_type == 'Basement' %}selected{% endif %}>Basement</option>
                    <option value="Other" {% if sighting.room_type == 'Other' %}selected{% endif %}>Other</option>
                </select>
            </div>
        </div>

        <!-- Roach Details -->
        <div class="form-section">
            <h2>What Did You See?</h2>
            <div class="form-row">
                <div class="form-group">
                    <label for="roach_count">How Many?</label>
                    <input type="number" id="roach_count" name="roach_count" class="form-control"
                           min="1" value="{{ sighting.roach_count }}">
                </div>
                <div class="form-group">
                    <label for="roach_size">Size</label>
                    <select id="roach_size" name="roach_size" class="form-control">
                        <option value="">Select...</option>
                        <option value="Small (< 1cm)" {% if sighting.roach_size == 'Small (< 1cm)' %}selected{% endif %}>Small (< 1cm)</option>
                        <option value="Medium (1-2cm)" {% if sighting.roach_size == 'Medium (1-2cm)' %}selected{% endif %}>Medium (1-2cm)</option>
                        <option value="Large (2-3cm)" {% if sighting.roach_size == 'Large (2-3cm)' %}selected{% endif %}>Large (2-3cm)</option>
                        <option value="Very Large (> 3cm)" {% if sighting.roach_size == 'Very Large (> 3cm)' %}selected{% endif %}>Very Large (> 3cm)</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label for="roach_type">Type (if known)</label>
                <select id="roach_type" name="roach_type" class="form-control">
                    <option value="">Select...</option>
                    <option value="German Cockroach" {% if sighting.roach_type == 'German Cockroach' %}selected{% endif %}>German Cockroach</option>
                    <option value="American Cockroach" {% if sighting.roach_type == 'American Cockroach' %}selected{% endif %}>American Cockroach</option>
                    <option value="Oriental Cockroach" {% if sighting.roach_type == 'Oriental Cockroach' %}selected{% endif %}>Oriental Cockroach</option>
                    <option value="Brown-Banded Cockroach" {% if sighting.roach_type == 'Brown-Banded Cockroach' %}selected{% endif %}>Brown-Banded Cockroach</option>
                    <option value="Unknown" {% if sighting.roach_type == 'Unknown' %}selected{% endif %}>Unknown</option>
                </select>
            </div>
        </div>

        <!-- Photo -->
        <div class="form-section">
            <h2>Photo Evidence</h2>
            {% if sighting.photo_path %}
                <div class="current-photo">
                    <p><strong>Current Photo:</strong></p>
                    <img src="{{ url_for('static', filename=sighting.photo_path.replace('static/', '')) }}"
                         alt="Current photo" style="max-width: 300px; height: auto;">
                </div>
            {% endif %}
            <div class="form-group">
                <label for="photo">Upload New Photo (optional)</label>
                <input type="file" id="photo" name="photo" class="form-control" accept="image/*" capture="environment">
                <small class="form-help">Leave blank to keep current photo</small>
            </div>
            <div id="photoPreview" class="photo-preview"></div>
        </div>

        <!-- Additional Details -->
        <div class="form-section">
            <h2>Additional Information</h2>
            <div class="form-row">
                <div class="form-group">
                    <label for="weather">Weather</label>
                    <select id="weather" name="weather" class="form-control">
                        <option value="">Select...</option>
                        <option value="Sunny" {% if sighting.weather == 'Sunny' %}selected{% endif %}>Sunny</option>
                        <option value="Rainy" {% if sighting.weather == 'Rainy' %}selected{% endif %}>Rainy</option>
                        <option value="Humid" {% if sighting.weather == 'Humid' %}selected{% endif %}>Humid</option>
                        <option value="Dry" {% if sighting.weather == 'Dry' %}selected{% endif %}>Dry</option>
                        <option value="Stormy" {% if sighting.weather == 'Stormy' %}selected{% endif %}>Stormy</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="temperature">Temperature (Â°F)</label>
                    <input type="number" id="temperature" name="temperature" class="form-control"
                           step="0.1" value="{{ sighting.temperature if sighting.temperature else '' }}">
                </div>
            </div>
            <div class="form-group">
                <label for="notes">Notes</label>
                <textarea id="notes" name="notes" class="form-control" rows="4">{{ sighting.notes if sighting.notes else '' }}</textarea>
            </div>
        </div>

        <!-- Submit -->
        <div class="form-actions">
            <button type="submit" class="btn-primary">Update Sighting</button>
            <a href="{{ url_for('view_sighting', sighting_id=sighting.id) }}" class="btn-secondary">Cancel</a>
        </div>
    </form>
</div>

{% endblock %}

{% block extra_scripts %}
<script>
    // Photo preview
    document.getElementById('photo').addEventListener('change', function(e) {
        const file = e.target.files[0];
        const preview = document.getElementById('photoPreview');

        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.innerHTML = '<p><strong>New Photo Preview:</strong></p><img src="' + e.target.result + '" alt="Preview">';
            };
            reader.readAsDataURL(file);
        } else {
            preview.innerHTML = '';
        }
    });
</script>
{% endblock %}
