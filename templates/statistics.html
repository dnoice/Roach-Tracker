{% extends "base.html" %}

{% block title %}Statistics - Roach Tracker{% endblock %}

{% block content %}
<div class="statistics-page">
    <header class="page-header">
        <h1>Statistics & Analytics</h1>
        <p class="subtitle">Comprehensive roach sighting analysis</p>
    </header>

    <!-- Export Actions -->
    <div class="export-section">
        <h2>Generate Reports</h2>
        <div class="export-buttons">
            <a href="{{ url_for('export_pdf') }}" class="btn-primary">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <path d="M14 2v6h6M12 18v-6M9 15l3 3 3-3"/>
                </svg>
                Export PDF Report
            </a>
            <a href="{{ url_for('export_csv') }}" class="btn-secondary">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <path d="M14 2v6h6"/>
                </svg>
                Export CSV Data
            </a>
        </div>
    </div>

    <!-- Overall Stats -->
    <div class="stats-overview">
        <h2>Overall Statistics</h2>
        <div class="stats-grid">
            <div class="stat-card stat-large">
                <div class="stat-value">{{ stats.total_sightings }}</div>
                <div class="stat-label">Total Sightings</div>
            </div>
            <div class="stat-card stat-large">
                <div class="stat-value">{{ stats.total_roaches }}</div>
                <div class="stat-label">Total Roaches</div>
            </div>
            <div class="stat-card stat-large">
                <div class="stat-value">
                    {% if stats.total_sightings > 0 %}
                        {{ "%.1f"|format(stats.total_roaches / stats.total_sightings) }}
                    {% else %}
                        0
                    {% endif %}
                </div>
                <div class="stat-label">Avg per Sighting</div>
            </div>
        </div>
    </div>

    <!-- Location Distribution -->
    {% if stats.locations %}
        <div class="chart-section">
            <h2>Sightings by Location</h2>
            <div class="chart-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Location</th>
                            <th>Count</th>
                            <th>Percentage</th>
                            <th>Visual</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for location in stats.locations %}
                            <tr>
                                <td>{{ location.location }}</td>
                                <td>{{ location.count }}</td>
                                <td>{{ "%.1f"|format(location.count / stats.total_sightings * 100) }}%</td>
                                <td>
                                    <div class="bar-chart">
                                        <div class="bar" style="width: {{ location.count / stats.total_sightings * 100 }}%"></div>
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    {% endif %}

    <!-- Size Distribution -->
    {% if stats.sizes %}
        <div class="chart-section">
            <h2>Roach Size Distribution</h2>
            <div class="chart-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Size</th>
                            <th>Count</th>
                            <th>Percentage</th>
                            <th>Visual</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% set total_sized = stats.sizes|sum(attribute='count') %}
                        {% for size in stats.sizes %}
                            <tr>
                                <td>{{ size.roach_size }}</td>
                                <td>{{ size.count }}</td>
                                <td>{{ "%.1f"|format(size.count / total_sized * 100) }}%</td>
                                <td>
                                    <div class="bar-chart">
                                        <div class="bar" style="width: {{ size.count / total_sized * 100 }}%"></div>
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    {% endif %}

    <!-- Time of Day Distribution -->
    {% if stats.times_of_day %}
        <div class="chart-section">
            <h2>Sightings by Time of Day</h2>
            <div class="chart-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Time of Day</th>
                            <th>Count</th>
                            <th>Percentage</th>
                            <th>Visual</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% set total_times = stats.times_of_day|sum(attribute='count') %}
                        {% for time in stats.times_of_day %}
                            <tr>
                                <td>{{ time.time_of_day }}</td>
                                <td>{{ time.count }}</td>
                                <td>{{ "%.1f"|format(time.count / total_times * 100) }}%</td>
                                <td>
                                    <div class="bar-chart">
                                        <div class="bar" style="width: {{ time.count / total_times * 100 }}%"></div>
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    {% endif %}

    <!-- Recent Trend (Last 7 Days) -->
    {% if stats.recent_trend %}
        <div class="chart-section">
            <h2>Recent Activity (Last 7 Days)</h2>
            <div class="chart-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Sightings</th>
                            <th>Visual</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% set max_count = stats.recent_trend|map(attribute='count')|max %}
                        {% for day in stats.recent_trend|reverse %}
                            <tr>
                                <td>{{ day.date }}</td>
                                <td>{{ day.count }}</td>
                                <td>
                                    <div class="bar-chart">
                                        <div class="bar" style="width: {{ day.count / max_count * 100 if max_count > 0 else 0 }}%"></div>
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    {% endif %}

    <!-- Empty State -->
    {% if stats.total_sightings == 0 %}
        <div class="empty-state">
            <p>No statistics available yet.</p>
            <a href="{{ url_for('log_sighting') }}" class="btn-primary">Log Your First Sighting</a>
        </div>
    {% endif %}
</div>
{% endblock %}
